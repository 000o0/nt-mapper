#include "shellcode.hpp"
#include "maker.hpp"
#include "cast.hpp"

std::array<std::byte, shellcode::call_dllmain_size> shellcode::call_dllmain(uintptr_t image, uintptr_t dllmain)
{
	// dllmain_call_x64.asm
	auto shellcode = maker::create_byte_array(
		0x48, 0x83, 0xEC, 0x28, 0x48, 0xB9,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x48, 0xC7, 0xC2, 0x01, 0x00, 0x00, 0x00,
		0x4D, 0x31, 0xC0, 0x48, 0xB8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xFF, 0xD0, 0x48, 0x83, 0xC4, 0x28, 0xC3);

	*cast::pointer(shellcode.data() + 0x6) = image;
	*cast::pointer(shellcode.data() + 0x1A) = dllmain;

	return shellcode;
}
